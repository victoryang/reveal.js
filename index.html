<!doctype html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

		<title>reveal.js</title>

		<link rel="stylesheet" href="css/reset.css">
		<link rel="stylesheet" href="css/reveal.css">
		<link rel="stylesheet" href="css/theme/black.css">

		<!-- Theme used for syntax highlighting of code -->
		<link rel="stylesheet" href="lib/css/monokai.css">

		<!-- Printing and PDF exports -->
		<script>
			var link = document.createElement( 'link' );
			link.rel = 'stylesheet';
			link.type = 'text/css';
			link.href = window.location.search.match( /print-pdf/gi ) ? 'css/print/pdf.css' : 'css/print/paper.css';
			document.getElementsByTagName( 'head' )[0].appendChild( link );
		</script>
	</head>
	<body>
		<div class="reveal">
			<div class="slides">
				<section>
					<h2 style="color: #1b91ff">监控系统重构方案进展</h2>
				</section>
				<section data-markdown style="color: #1b91ff">
					1. 需求
					2. 系统实现
					3. 未来
				</section>
				<section>
					<section>
						<div style="color: #1b91ff">需求</div>
						<br>
						<br>
						<div class="fragment fade-in">
							1. 系统的可靠性
						</div>
						<br>
						<div class="fragment fade-in">
							2. 系统的易维护性
						</div>
					</section>		
				</section>
				<section>
					<section>
						<div style="color: #1b91ff">系统实现</div>
					</section>
					<section data-markdow>
						<p2 style="color: #1b91ff">全部基于开源组件配置部署</p2>
						<br>
						<br>
						<table class="reveal">
					    	<tr>
							<th>系统</th>
							<th>组成</th>
							<th>监控内容</th>
							</tr>

							<tr>
							<td>zabbix</td>
							<td>zabbix</td>
							<td>物理机资源</td>
							</tr>

							<tr>
							<td>graphite</td>
							<td>collectd<br>graphite生态</td>
							<td>物理机资源<br>容器和服务等</td>
							</tr>

							<tr>
							<td>open-falcon</td>
							<td>open-falcon生态</td>
							<td>mysql实例</td>
							</tr>
						</table>
					</section>

					<section>
						<img src="graphite.png" style="width:700px;height:600px;">
					</section>

					<section data-markdown>
						- zabbix使用时间最早，监控了物理机等很多资源，与graphite等有数据重复的问题
						- graphite在整个监控系统占最主要地位，现有部署情况
						    - 集群部署基于graphite官方推荐，使用第三方go开发的高性能组件代替部分官方组件
						    - 现有部署的架构，采用分片策略，数据采集后，基于一致性哈希算法，分片分发到不同集群carbon中，由graphite-web进行聚合
						- falcon本意代替graphite，最后只迁移了mysql部分
					</section>

					<section data-markdown>
						- 在开源社区内，prometheus的关注度很高，在容器云/kubernetes领域也是不二的选择。官网上也给出了与其他监控系统的对比，给出了适应的场景，需要结合现有实际，以及未来的规划，找出合适的方案
					</section>
				</section>

				<section>
					<section>
						<div style="color: #1b91ff">未来</div>
						<br>
						<br>

						<div style="color: #1b91ff" class="fragment fade-in">Prometheus</div>
					</section>
					
					<section>
						<div style="color: #1b91ff">Scope</div>
						<br>
						<br>
						<div>Prometheus is a full monitoring and trending system that includes built-in and active scraping, storing, querying, graphing, and alerting based on time series data</div>
					</section>

					<section data-markdown>
						<div style="color: #1b91ff">Data model</div>

	stats.api-server.tracks.post.500 -> 93
	
	api_server{method="POST",handler="/tracks",status="500",instance="<sample1>"} -> 34
	api_server{method="POST",handler="/tracks",status="500",instance="<sample2>"} -> 28
	api_server{method="POST",handler="/tracks",status="500",instance="<sample3>"} -> 31
					</section>

					<section>
						<div style="color: #1b91ff">Storage</div>
					</section>

					<section>
						<img src="Prometheus.png" style="width:800px;height:600px;">
					</section>

					<section>
						<img src="federation.jpg" style="width:800px;height:600px;">
					</section>
				</section>

				<section>
					<div style="color: #1b91ff">End</div>
				</section>
			</div>
		</div>

		<script src="js/reveal.js"></script>

		<script>
			// More info about config & dependencies:
			// - https://github.com/hakimel/reveal.js#configuration
			// - https://github.com/hakimel/reveal.js#dependencies
			Reveal.initialize({
				dependencies: [
					{ src: 'plugin/markdown/marked.js' },
					{ src: 'plugin/markdown/markdown.js' },
					{ src: 'plugin/notes/notes.js', async: true },
					{ src: 'plugin/highlight/highlight.js', async: true }
				]
			});
		</script>
	</body>
</html>
