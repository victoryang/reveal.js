<!doctype html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

		<title>reveal.js</title>

		<link rel="stylesheet" href="css/reset.css">
		<link rel="stylesheet" href="css/reveal.css">
		<link rel="stylesheet" href="css/theme/black.css">

		<!-- Theme used for syntax highlighting of code -->
		<link rel="stylesheet" href="lib/css/monokai.css">

		<!-- Printing and PDF exports -->
		<script>
			var link = document.createElement( 'link' );
			link.rel = 'stylesheet';
			link.type = 'text/css';
			link.href = window.location.search.match( /print-pdf/gi ) ? 'css/print/pdf.css' : 'css/print/paper.css';
			document.getElementsByTagName( 'head' )[0].appendChild( link );
		</script>
	</head>
	<body>
		<div class="reveal">
			<div class="slides">
				<section data-markdown data-background-image="background_xueqiu.jpeg">
					## 监控系统重构方案进展

					<img data-src="pasted-image.png">
				</section>
				<section data-markdown style="color: #1b91ff">
					* 需求
					* 现状
					* 未来
				</section>
				<section>
					<section>
						<div style="color: #1b91ff">需求</div>
						<br>
						<br>
						<div class="fragment fade-up">
							1. 系统可用性
						</div>
						<br>
						<div class="fragment fade-up">
							2. 系统易维护度
						</div>
					</section>		
				</section>
				<section>
					<section data-markdow>
						<div style="color: #1b91ff">系统现状</div>
						<br>
						<br>
						<table class="reveal fragment fade-up">
					    	<tr>
							<th>系统</th>
							<th>组成</th>
							<th>监控内容</th>
							</tr>

							<tr>
							<td>zabbix</td>
							<td>zabbix</td>
							<td>物理机资源<br>部分业务监控</td>
							</tr>

							<tr>
							<td>graphite</td>
							<td>collectd<br>graphite生态</td>
							<td>物理机资源<br>容器和服务等</td>
							</tr>

							<tr>
							<td>open-falcon</td>
							<td>open-falcon生态</td>
							<td>mysql实例</td>
							</tr>
						</table>
					</section>

					<section>
						<ul>
							<li>zabbix使用时间最早，监控了物理机等很多资源，与graphite等有数据重复的问题</li>
							<li class="fragment fade-up">graphite在整个监控系统占最主要地位
								<ul>
									<li class="fragment fade-up">集群部署基于graphite官方推荐，使用第三方go开发的高性能组件代替部分官方组件</li>
									<li class="fragment fade-up">现有部署的架构，采用分片策略，数据采集后，基于一致性哈希算法，分片分发到集群中不同的carbon中，由graphite-web进行聚合</li>
								</ul>
							</li>
							<li class="fragment fade-up">falcon本意代替graphite，最终只迁移了mysql部分</li>
						</ul>
					</section>

					<section>
						<img src="graphite-upstream.png" style="width:700px;height:600px;">
					</section>

					<section>
						<img src="graphite.png" style="width:700px;height:600px;">
					</section>

					<section>
						<div style="color: #1b91ff">问题</div>
						<br>
						<br>

						<ul>
							<li class="fragment fade-up">需要管理多个系统，整体混乱</li>
							<li class="fragment fade-up">与ldap、cmdb等管理平台的联动性不高</li>
							<li class="fragment fade-up">部署系统的HA方案有缺陷</li>
							<li class="fragment fade-up">社区活跃度及行业关注度</li>
						</ul>
					</section>

				</section>

				<section>
					<section>
						<div style="color: #1b91ff">未来</div>
						<br>
						<br>

						<div style="color: #1b91ff" class="fragment fade-in">Prometheus</div>
					</section>
					
					<section>
						<img src="Prometheus.png" style="width:800px;height:600px;">
					</section>

					<section>
						<div style="color: #1b91ff">Scope</div>
						<br>
						<br>
						<div style="font-size: 30px">Prometheus is a full monitoring and trending system that includes built-in and active scraping, storing, querying, graphing, and alerting based on time series data</div>
					</section>

					<section>
						<div style="color: #1b91ff">Data model</div>
						<br>
						<br>

						<code class="hljs" style="font-size: 20px">
							stats.api-server.tracks.post.500 -> 93
						</code>

						<br>

<pre><code class="hljs" style="font-size: 17px">api_server{method="POST",handler="/tracks",status="500",instance="sample1"} -> 34
api_server{method="POST",handler="/tracks",status="500",instance="sample2"} -> 28
api_server{method="POST",handler="/tracks",status="500",instance="sample3"} -> 31
</code></pre>

					</section>

					<section>
						<div style="color: #1b91ff">Storage</div>
						<br>

						<ul>
							<li>Local Storage
								<ul>
									<li>wal</li>
									<li>tsdb(future)</li>
								</ul>
							</li>
							<li>Remote Storage
								<ul>
									<li>remote read</li>
									<li>remote write</li>
								</ul>
							</li>
						</ul>

					</section>

					<section>
						<img src="federation.jpg" style="width:800px;height:600px;">
					</section>

					<section data-markdown>
						- 优势
							- 在开源社区内，prometheus的活跃度和关注度很高，在容器云/kubernetes领域是主流选择
							- 官方提供较可靠的HA方案
							- 业界有较多尝试和分享
						- 问题
							- 报警模块无可视化界面，添加报警规则需要手动修改配置
							- data model采用独特的结构

					</section>

					<section data-markdown>
						<div style="color: #1b91ff">方案</div>
						<br>

						- 在现有系统上解决与其他管理系统联动问题
						- Prometheus接管falcon监控内容
							- 研究HA方案，搭建可靠的监控系统
							- 提供UI，实现报警可视化配置
							- data model迁移
							- 扩展方案
						- 移出zabbix业务相关监控项至prometheus
						- 逐步承接graphite相关监控内容
						- 探寻其他方案的可能性	
					</section>

				</section>

				<section>
					<section>
						<div style="color: #1b91ff">To be continued ...</div>
					</section>

				</section>
			</div>
		</div>

		<script src="js/reveal.js"></script>

		<script>
			// More info about config & dependencies:
			// - https://github.com/hakimel/reveal.js#configuration
			// - https://github.com/hakimel/reveal.js#dependencies
			Reveal.initialize({
				dependencies: [
					{ src: 'plugin/markdown/marked.js' },
					{ src: 'plugin/markdown/markdown.js' },
					{ src: 'plugin/notes/notes.js', async: true },
					{ src: 'plugin/highlight/highlight.js', async: true }
				]
			});
		</script>
	</body>
</html>
